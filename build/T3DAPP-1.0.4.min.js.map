{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/FlyControls.js","src/SceneUtils.js","src/Tyria3DApp.js","src/UI.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","raycaster","controls","SceneUtils","velocity","THREE","Vector3","moveUp","moveForward","moveBackward","moveLeft","moveRight","canJump","speed","isFly","mapReady","FlyControls","prototype","updateURL","pos","getObject","position","pitch","Math","round","getPitchObject","rotation","x","yaw","y","mapFileName","$","val","window","location","href","split","z","getControls","setSpeed","value","toggleFly","setSensitivity","invertMouse","update","delta","enabled","underwater","object","dirSpeed","getDirection","normalize","multiplyScalar","set","translateX","translateY","intersections","ray","origin","copy","intersectObjects","getCollisions","max","distance","translateZ","lock","element","document","body","requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock","setMapReady","init","self","this","exitPointerLock","mozExitPointerLock","webkitExitPointerLock","pointerlockchange","event","pointerLockElement","mozPointerLockElement","webkitPointerLockElement","controlsEnabled","fadeOut","fadeIn","pointerlockerror","addEventListener","getRenderer","domElement","on","PointerLockControls","getCamera","getScene","add","keyCode","Raycaster","scene","skyScene","camera","oCamera","currentCamera","skyCamera","cameraOpts","renderer","collisions","nonCollisions","terrainChunks","lights","skyObjects","fogDistance","renderCounter","traverseLODs","LOD","setupScene","Scene","sceneWidth","innerWidth","PerspectiveCamera","innerHeight","directionalLight","globalAmbient","AmbientLight","DirectionalLight","fog","Fog","WebGLRenderer","sortObjects","stencil","premultipliedAlpha","antialiasing","setSize","autoClear","style","appendChild","resize","render","setPerspective","setOrthographic","b","fac","aspect","dx","abs","dy","m","OrthographicCamera","PI","setHSLa","h","color","setHSL","intensity","setRenderVisible","display","applyCameraRotationTo","parent","rx","ry","traverse","clear","getClearColor","forEach","elem","remove","updateProjectionMatrix","setAmbientAdd","v","added","addScalar","setFog","far","near","mesh","material","uniforms","needsUpdate","showProgressPanel","cb","pp","is","find","html","showPanel","showMapPanel","panelIn","currentPanel","swapPanels","panelOut","dir","css","height","removeClass","animateOutProp","animateInProp","addClass","right","left","animate","getSkyScene","getNonCollisions","getTerrainChunks","getSkyObjects","getLights","UI","Tyria3DApp","map","stats","controller","hasPointerLock","ui","lastTs","animating","localReader","_mapRect","animationTime","ready","onDocumentReady","bind","initAnim","first","margin-top","slideUp","delay","hide","Stats","append","loadMap","filePicker","fileIcon","click","trigger","change","evt","file","target","files","T3D","getLocalReader","setTimeout","getMapListAsync","applyMapList","undefined","deepSearchButton","confirm","searchParagraph","keyDownListener","mouseWheelListener","fileName","absolute","renderers","renderClass","HavokRenderer","settings","visible","checked","EnvironmentRenderer","TerrainRenderer","anisotropy","getMaxAnisotropy","prop","push","ZoneRenderer","PropertiesRenderer","renderMapContentsAsync","onMapLoaded","mapData","meshes","skyElements","terrainTiles","water","hazeColor","Color","setClearColor","bounds","slider","hasLight","y2","mapList","picker","empty","compareName","name","maps","sort","g","group","sign","wheelDelta","min","timestamp","requestAnimationFrame","toggle","xMin","x1","xMax","x2","yMin","y1","yMax","console","log","version","hasWebGL","WebGLRenderingContext","one","holder","selectMap","mapListObject","filter","logProgress","op","arguments","parseFloat","Logger","logFunctions","TYPE_PROGRESS","TYPE_DEBUG","$UI","outputWrapper","top","output","progressOutput","errorOutput","suspendedPanel","mapOpts","reload","MapFileList","label","blur","movementOpts","step","exp","sens","select"],"mappings":"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","file":"T3DAPP-1.0.4.min.js","sourcesContent":["(function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}return e})()","//require(\"../../../vendor/three/PointerLockControls\");\nvar SceneUtils = require(\"./SceneUtils\");\n\n\nvar velocity = new THREE.Vector3();\nvar moveUp = false;\nvar moveForward = false;\nvar moveBackward = false;\nvar moveLeft = false;\nvar moveRight = false;\nvar isOnObject = false;\nvar canJump = false;\nvar raycaster;\nvar controls;\nvar speed = 500;\nvar sensitivity = 500;\nvar bodyHeight = 70;\nvar isFly = true;\nvar mapReady = false;\n\nvar FlyControls = function(){\n\t///this. .. = \n\t//this.();\n};\n\nFlyControls.prototype.updateURL = function(){\n\t/// Write position to UI (fugly but whatevs)\n\tvar pos = controls.getObject().position;\n\t\n\tvar pitch =  Math.round(controls.getPitchObject().rotation.x*10000)/10000;\n\tvar yaw =   Math.round(controls.getObject().rotation.y*10000)/10000;\n\t\n\tvar mapFileName = $(\"#mapPicker\").val();\n\n\t$(\"#locationInput\").val(\n\t\twindow.location.href.split(\"#\")[0]+\"#\"+\n\t\tmapFileName+\",\"+\n\t\tMath.round(pos.x*1000)/1000+\",\"+\n\t\tMath.round(pos.y*1000)/1000+\",\"+\n\t\tMath.round(pos.z*1000)/1000+\",\"+\n\t\tpitch+\",\"+\n\t\tyaw\n\t);\n\n}\n\nFlyControls.prototype.getControls=function(){\n\treturn controls;\n}\n\nFlyControls.prototype.setSpeed=function(value){\n\tspeed = value;\n}\n\nFlyControls.prototype.toggleFly=function(){\n\tisFly = !isFly;\n}\n\nFlyControls.prototype.setSensitivity=function(value){\n\tcontrols.setSensitivity(value);\n}\n\nFlyControls.prototype.invertMouse = function(){\n\tcontrols.invertMouse();\n};\n\nFlyControls.prototype.update=function(delta){\n\tif( controls.enabled ){\n\n\n\n\t\tvar underwater = controls.getObject().position.y<0;\n\n\t\tif(isFly || underwater){\n\t\t\t/// Free fly\n\t\t\tvar object = controls.getObject();\n\t\t\tvelocity.x = 0;\n\t\t\tvelocity.y = 0;\n\n\t\t\t// TODO: handle water better\n\t\t\tvelocity.z = 0;\n\n\t\t\t\n\t\t\tif( moveForward || moveBackward){\n\t\t\t\tvar dirSpeed = moveForward ? speed : -speed;\n\t\t\t\tcontrols.getDirection( velocity );\n\t\t\t\tvelocity.normalize();\n\t\t\t\t\n\t\t\t\t\n\t\t        //vector.applyEuler(camera.rotation, camera.rotation.order).normalize();\n\t\t        velocity.multiplyScalar(dirSpeed);\n\n\t\t        object.position.set(\n\t\t\t\tobject.position.x + velocity.x * delta,\n\t\t\t\tobject.position.y + velocity.y * delta,\n\t\t\t\tobject.position.z + velocity.z * delta);\n\t\t\t}\n\n\t\t\tif( moveLeft || moveRight){\n\t\t\t\tvar dirSpeed = moveRight ? speed : -speed;\n\t\t\t\tobject.translateX( dirSpeed * delta );\n\t\t\t}\n\n\t\t\tif(moveUp){\n\t\t\t\tcontrols.getObject().translateY( speed * delta );\n\t\t\t}\n\t\t} /// End if fly\n\n\t\telse{\n\t\t\t\n\t\t\t\n\t\t\tif ( moveForward ) \t\t\tvelocity.z = -speed;\n\t\t\telse if ( moveBackward ) \tvelocity.z = speed;\n\t\t\telse \t\t\t\t\t\tvelocity.z = 0;\n\n\t\t\tif ( moveLeft ) \t\t\tvelocity.x = -speed;\n\t\t\telse if ( moveRight ) \t\tvelocity.x = speed;\n\t\t\telse \t\t\t\t\t\tvelocity.x = 0;\n\n\t\t\n\t\t\tvar intersections;\n\n\t\t\t//if( velocity.y < 0 ){\n\t\t\t\traycaster.ray.origin.copy( controls.getObject().position );\n\t\t\t\t\n\t\t\t\t/// Check for object under us\n\t\t\t\tintersections = raycaster.intersectObjects( SceneUtils.getCollisions() );\n\n\t\t\t\t/// If there are any, valocity will be set to 0 or higher, if not gravity will pull\n\t\t\t\tisOnObject = intersections.length > 0;\n\t\t\t/*}\n\t\t\telse if( velocity.y > 0){\n\t\t\t\tisOnObject = false;\n\t\t\t}*/\n\n\t\t\n\t\t\tif ( isOnObject === true ) {\n\t\t\t\tvelocity.y = Math.max( 0, velocity.y );\n\n\t\t\t\t/// Move up to avoid sinking trough ground\n\t\t\t\tvar eps = 1;\n\t\t\t\tcontrols.getObject().translateY( bodyHeight - intersections[0].distance - eps);\n\n\t\t\t\t//canJump = true;\n\t\t\t}\n\t\t\telse{\n\t\t\t\tvelocity.y -= speed * 2 * delta; \n\t\t\t}\n\n\t\t\tcontrols.getObject().translateX( velocity.x * delta );\n\t\t\tcontrols.getObject().translateY( velocity.y * delta );\n\t\t\tcontrols.getObject().translateZ( velocity.z * delta );\n\n\t\t}/// End if not fly\n\t\t\n\n\n\t\t\n\n\t\treturn true;\n\t}\n\n\treturn false;\n\n}\n\nFlyControls.prototype.lock=function(){\n\tvar element = document.body;\n\n\t// Ask the browser to lock the pointer\n\telement.requestPointerLock = element.requestPointerLock || element.mozRequestPointerLock || element.webkitRequestPointerLock;\n\n\tif ( false &&  /Firefox/i.test( navigator.userAgent ) ) {\n\n\t\tvar fullscreenchange = function ( event ) {\n\n\t\t\tif ( document.fullscreenElement === element || document.mozFullscreenElement === element || document.mozFullScreenElement === element ) {\n\n\t\t\t\tdocument.removeEventListener( 'fullscreenchange', fullscreenchange );\n\t\t\t\tdocument.removeEventListener( 'mozfullscreenchange', fullscreenchange );\n\n\t\t\t\telement.requestPointerLock();\n\t\t\t}\n\n\t\t}\n\n\t\tdocument.addEventListener( 'fullscreenchange', fullscreenchange, false );\n\t\tdocument.addEventListener( 'mozfullscreenchange', fullscreenchange, false );\n\n\t\telement.requestFullscreen = element.requestFullscreen || element.mozRequestFullscreen || element.mozRequestFullScreen || element.webkitRequestFullscreen;\n\n\t\telement.requestFullscreen();\n\n\t} else {\n\n\t\telement.requestPointerLock();\n\n\t}\n}\n\nFlyControls.prototype.setMapReady=function(value){\n\tmapReady = value;\n};\n\nFlyControls.prototype.init=function(){\n\tvar havePointerLock = 'pointerLockElement' in document || 'mozPointerLockElement' in document || 'webkitPointerLockElement' in document;\n\n\tif ( havePointerLock ) {\n\n\t\tvar self = this;\n\t\tvar element = document.body;\n\n\t\tdocument.exitPointerLock = document.exitPointerLock ||\n\t\t\t   document.mozExitPointerLock ||\n\t\t\t   document.webkitExitPointerLock;\n\t\t\n\n\t\tvar pointerlockchange = function ( event ) {\n\n\t\t\tif(!mapReady)\n\t\t\t\treturn;\n\t\t\t\n\t\t\tif ( document.pointerLockElement === element || document.mozPointerLockElement === element || document.webkitPointerLockElement === element ) {\n\n\t\t\t\tcontrolsEnabled = true;\n\t\t\t\tcontrols.enabled = true;\n\n\t\t\t\t$(\"#output\").fadeOut(300);\n\n\n\t\t\t} else {\n\t\t\t\t$(\"#output\").fadeIn(300);\n\n\t\t\t\tself.updateURL();\n\n\t\t\t\tcontrols.enabled = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\tvar pointerlockerror = function ( event ) {\n\t\t\t//instructions.style.display = '';\n\n\t\t}\n\n\t\t// Hook pointer lock state change events\n\t\tdocument.addEventListener( 'pointerlockchange', pointerlockchange, false );\n\t\tdocument.addEventListener( 'mozpointerlockchange', pointerlockchange, false );\n\t\tdocument.addEventListener( 'webkitpointerlockchange', pointerlockchange, false );\n\n\t\tdocument.addEventListener( 'pointerlockerror', pointerlockerror, false );\n\t\tdocument.addEventListener( 'mozpointerlockerror', pointerlockerror, false );\n\t\tdocument.addEventListener( 'webkitpointerlockerror', pointerlockerror, false );\n\n\t\tSceneUtils.getRenderer().domElement.addEventListener( 'mousedown', function ( event ) {\n\t\t\tif(mapReady)\n\t\t\t\tself.lock();\n\t\t}, false );\n\t\t$(\"#outputWrapper\").on( 'mousedown', function ( event ) {\n\t\t\tif(mapReady)\n\t\t\t\tself.lock();\n\t\t});\n\n\t\tdocument.addEventListener( 'mouseup', function ( event ) {\n\t\t\tdocument.exitPointerLock();\n\t\t\tcontrols.enabled = false;\n\t\t}, false );\n\n\t\t\n\n\t} else {\n\n\t\treturn false;\n\n\t}\n\n    controls = new THREE.PointerLockControls( SceneUtils.getCamera(), 0.002 );\n    \t\n\tSceneUtils.getScene().add( controls.getObject() );\n\n    var onKeyDown = function ( event ) {\n\n\t\tswitch ( event.keyCode ) {\n\n\t\t\tcase 38: // up\n\t\t\tcase 87: // w\n\t\t\t\tmoveForward = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 37: // left\n\t\t\tcase 65: // a\n\t\t\t\tmoveLeft = true; break;\n\n\t\t\tcase 40: // down\n\t\t\tcase 83: // s\n\t\t\t\tmoveBackward = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 39: // right\n\t\t\tcase 68: // d\n\t\t\t\tmoveRight = true;\n\t\t\t\tbreak;\n\n\t\t\tcase 32: // space\n\t\t\t\t// Used fo moving up in fly mode and jumping in FPS mode\n\t\t\t\tmoveUp = true;\n\t\t\t\t\n\t\t\t\t// Used for jumping in non-fly mode\n\t\t\t\tif ( canJump === true ){\n\t\t\t\t\tvelocity.y += speed;\n\t\t\t\t\tcanJump = false;\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tvar onKeyUp = function ( event ) {\n\n\t\tswitch( event.keyCode ) {\n\n\t\t\tcase 38: // up\n\t\t\tcase 87: // w\n\t\t\t\tmoveForward = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 37: // left\n\t\t\tcase 65: // a\n\t\t\t\tmoveLeft = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 40: // down\n\t\t\tcase 83: // s\n\t\t\t\tmoveBackward = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 39: // right\n\t\t\tcase 68: // d\n\t\t\t\tmoveRight = false;\n\t\t\t\tbreak;\n\n\t\t\tcase 32: // space\n\t\t\t\tmoveUp = false;\n\t\t\t\t//Allowing tapping space to mid air jump again\n\t\t\t\tcanJump = true;\n\t\t\t\tbreak;\n\n\t\t}\n\n\t};\n\n\tdocument.addEventListener( 'keydown', onKeyDown, false );\n\tdocument.addEventListener( 'keyup', onKeyUp, false );\n\n\traycaster = new THREE.Raycaster( new THREE.Vector3(), new THREE.Vector3( 0, - 1, 0 ), 0, bodyHeight );\n\n\treturn true;\n\t\n};\n\n\nmodule.exports = FlyControls;","var cameraOpts = {\n\tfov : 60,\tnear : 10, foglength:5000\n};\n\nvar scene, skyScene;\nvar camera, oCamera;\nvar currentCamera, skyCamera; \nvar renderer = null;\n\nvar collisions = [];\nvar nonCollisions = [];\nvar terrainChunks = [];\nvar lights = [];\n\nvar skyObjects = [];\n\nvar fogDistance = 0;\n\nvar renderCounter = 0;\n\nfunction traverseLODs( object ) {\n\tif ( object instanceof THREE.LOD ) {\n\t\tobject.update( camera );\n\t}\n}\n\n\n\nmodule.exports = {\n\tsetupScene : function() {\n\n\t\t/// Create scene instance\n\t\tscene = new THREE.Scene();\n\t\tskyScene = new THREE.Scene();\n\n\t\t/// Create a camera, aim and place it.\n\t\tvar sceneWidth = window.innerWidth;// -  $(\"#UI\").width();\n\n\t\tcurrentCamera = camera = new THREE.PerspectiveCamera(cameraOpts.fov,\n\t\t\tsceneWidth / window.innerHeight,\n\t\t\tcameraOpts.near, fogDistance );\n\n\t\tskyCamera = new THREE.PerspectiveCamera(cameraOpts.fov,\n\t\t\tsceneWidth / window.innerHeight,\n\t\t\tcameraOpts.near, 1000000);\n\t\t\t\n\t\t\t\t\n\n\t\t/// Add ambient lighting\n\t\t\n\t\tvar globalAmbient = new THREE.AmbientLight(0);\n\t\tscene.add(globalAmbient);\n\t\t\n\n\t\tvar directionalLight = new THREE.DirectionalLight( 0xffffff, 0.7 );\n\t\tdirectionalLight.position.set( 0, 0, 1 );\n\t\tscene.add( directionalLight );\n\t\t\n\n\t\tvar directionalLight = new THREE.DirectionalLight( 0xffffff, 0.3 );\n\t\tdirectionalLight.position.set( -1, 1, -1 );\n\t\tscene.add( directionalLight );\n\n\t\t/*\n\n\t\tvar d = 0.53;\n\t\tvar h = 0.27;\n\t\tvar dh = 0.2;\n\t\tvar s = 0.4;//0.3\n\t\tvar l = 0.6;//0.5\n\n\t\tvar alpha = 0.45;\n\n\t\tfor(var i=0; i<5; i++){\n\t\t\tvar li = new THREE.DirectionalLight( 0, 1);\n\t\t\tscene.add(li);\n\t\t\tlights.push(li);\n\t\t}\n\n\t\tlights[0].position.set( 0, 1, 0  );\n\t\tlights[1].position.set( -0.5, 0*0.5, -d );\n\t\tlights[2].position.set( 0.5, 0, -d );\n\t\tlights[3].position.set( 0, -1, 0 );\n\t\tlights[4].position.set( 0, 0*-0.5, d );\n\n\t\tthis.setHSLa(h,s,l,alpha);*/\n\n\n\n\n\t\t/// Add directional lights\n\t\t/*var d5 = new THREE.DirectionalLight( 0, alpha);\n\t\td5.color.setHSL( h, s, l );\n\t\td5.position.set( 0, 1, 0  );\n\t\tscene.add( d5 );\n\n\t\tvar d1 = new THREE.DirectionalLight( 0, alpha);\n\t\th=(h+dh)%1;\n\t\td1.color.setHSL( h, s, l );\n\t\td1.position.set( -0.5, 0*0.5, -d );\n\t\tscene.add( d1 );\n\n\t\tvar d2 = new THREE.DirectionalLight( 0, alpha );\n\t\th=(h+dh)%1;\n\t\td2.color.setHSL( h, s, l );\n\t\td2.position.set( 0.5, 0, -d );\n\t\tscene.add( d2 );\n\n\n\t\tvar d4 = new THREE.DirectionalLight( 0, alpha );\n\t\th=(h+dh)%1;\n\t\td4.color.setHSL( h, s, l );\n\t\td4.position.set( 0, -1, 0 );\n\t\tscene.add( d4 );\n\t\t\n\t\tvar d3 = new THREE.DirectionalLight( 0, alpha );\n\t\th=(h+dh)%1;\n\t\td3.color.setHSL( h, s, l );\n\t\td3.position.set( 0, 0*-0.5, d );\n\t\tscene.add( d3 );*/\n\n\t\t//Fog\n\t\tscene.fog = new THREE.Fog(0xffffff, Math.max(1,fogDistance - cameraOpts.foglength), fogDistance);\n\n\t\t// LOD updates scene by itself before render is called, don't do it twice!\n\t\t//scene.matrixAutoUpdate = false;\n\t\t//scene.autoUpdate = false;\n\t\t\n\t\t/*var light = new THREE.PointLight( 0xffffff, 0.7, 5000 );\n\t\tlight.position.set( 50, 50, 50 );\n\t\tcamera.add(light);*/\n\t\t\n\t\t/// Create canvas rendering output\n\t\trenderer = new THREE.WebGLRenderer({\n\t\t\t/*alpha:true*/\n\t\t\tsortObjects:false,\n\t\t\tstencil:false,\n\t\t\tpremultipliedAlpha:false,\n\t\t\tantialiasing: true ,\n\t\t\t//preserveDrawingBuffer:true\n\t\t});\n\t\trenderer.sortObjects = false;\n\t\trenderer.setSize(sceneWidth, window.innerHeight);\n\t\t//renderer.setClearColor( 0xffffff, 1.0 );\n\t\t//renderer.setClearColor( 0xccbbdd );\n\t\trenderer.autoClear = false;\n\n\t\trenderer.domElement.style.position = \"absolute\";\n\n\t\t/// Add renderer to html DOM\n\t\tdocument.body.appendChild(renderer.domElement);\n\n\t\t/// Listen to window size chaning\n\t\t$( window ).resize(this.resize);\n\n\t\tthis.render();\n\n\n\t},\n\n\tsetPerspective: function(){\n\t\tcurrentCamera = camera;\n\t\tthis.render();\n\t},\n\n\tsetOrthographic: function(l,r,t,b,n,f){\n\n\t\tvar sceneWidth = window.innerWidth;// -  ( $(\"#UI\").is(\":visible\") && $(\"#UI\").width() );\n\n\t\tvar aspect = sceneWidth / window.innerHeight;\n\n\t\tvar dx = Math.abs(l-r);\n\t\tvar dy = Math.abs(t-b);\n\n\t\tif( dx/dy < aspect ){\n\t\t\tvar targetDx = dy * aspect;\n\t\t\tvar fac = targetDx/(1.0*dx);\n\t\t\tl *= fac;\n\t\t\tr *= fac;\t\n\t\t}\n\t\telse{\n\t\t\tvar targetDy = dx / aspect;\n\t\t\tvar fac = targetDy/(1.0*dy);\n\t\t\tt *= fac;\n\t\t\tb *= fac;\t\n\t\t}\n\t\t\n\t\t///Margin\n\t\tvar m = 1.01;\n\t\tl*=m; r*=m; t*=m; b*=m;\n\n\t\toCamera = new THREE.OrthographicCamera(l,r,t,b,n,f);\n\t\toCamera.position.set( 0*(l+r)/2.0, -f/2.0, 0*(t+b)/2.0 );\n\t\toCamera.rotation.set(Math.PI/2.0,0,0,\"YXZ\");\t\t\n\n\t\t//this.applyCameraRotationTo(oCamera);\n\n\t\tcurrentCamera = oCamera;\n\n\t\tthis.render();\n\n\t},\n\n\tsetHSLa: function(h,s,l,a){\n\t\tvar dh = 0.2;\n\t\tfor(var i=0; i<5; i++){\n\t\t\tif(lights[i]){\n\t\t\t\tlights[i].color.setHSL(h,s,l);\n\t\t\t\tlights[i].intensity = a;\n\t\t\t\th=(h+dh)%1;\t\n\t\t\t}\n\t\t}\n\t},\n\n\tsetRenderVisible: function(value){\n\t\tif(value)\n\t\t\trenderer.domElement.style.display = \"block\";\n\t\telse\n\t\t\trenderer.domElement.style.display = \"none\";\n\t},\n\n\tapplyCameraRotationTo: function(o){\n\t\tif(camera.parent){\n\t\t\tvar rx = camera.parent.rotation.x;\n\t\t\tvar ry = camera.parent.parent.rotation.y;\n\t\t\to.rotation.set(rx,ry,0,\"YXZ\");\t\t\n\t\t}\n\t},\n\n\trender: function(){\n\t\tif(renderer !== null){\n\n\t\t\t/// Always update matrix\n\t\t\t//scene.updateMatrixWorld();\n\n\t\t\t/// Only calculate distances every n:th render\n\t\t\tif(++renderCounter == 10){\n\t\t\t\trenderCounter = 0;\n\t\t\t\tscene.traverse( traverseLODs );\n\t\t\t}\n\n\n\t\t\trenderer.clear(renderer.getClearColor());\n\n\t\t\t/// Render skybox\n\t\t\tif(camera == currentCamera){\n\t\t\t\tthis.applyCameraRotationTo(skyCamera);\n\t\t\t\trenderer.render(skyScene, skyCamera);\n\t\t\t}\n\t\t\telse{\n\t\t\t\t//this.applyCameraRotationTo(oCamera);\t\n\t\t\t}\n\n\t\t    /// Render everything else\n\t\t\trenderer.render(scene, currentCamera);\n\t\t}\n\t},\n\n\tclear: function(){\n\n\t\tcollisions.forEach(function(elem){\n\t\t\tscene.remove(elem);\n\t\t});\n\n\t\tnonCollisions.forEach(function(elem){\n\t\t\tscene.remove(elem);\n\t\t});\n\n\t\tlights.forEach(function(elem){\n\t\t\tscene.remove(elem);\n\t\t});\n\n\t\tskyObjects.forEach(function(elem){\n\t\t\tskyScene.remove(elem);\n\t\t});\n\t\t\n\t\tnonCollisions = [];\n\t\tcollisions = [];\n\t\tlights = [];\n\t\tskyObjects = [];\n\t\tterrainChunks = [];\n\t},\n\n\tresize: function(){\n\t\tvar sceneWidth = window.innerWidth;//-  ( $(\"#UI\").is(\":visible\") && $(\"#UI\").width() );\n\n\t\tcamera.aspect = sceneWidth / window.innerHeight;\n\t\tskyCamera.aspect = sceneWidth / window.innerHeight;\n\n\t\trenderer.setSize(sceneWidth, window.innerHeight);\n\n\t\tcamera.updateProjectionMatrix();\n\t\tskyCamera.updateProjectionMatrix();\n\n\n\t\tmodule.exports.render();\n\t},\n\n\tsetAmbientAdd: function(value){\n\t\tlights.forEach(\n\t\t\tfunction(elem){\n\t\t\t\tvar v = value;\n\t\t\t\tif(elem.added){\n\t\t\t\t\tv -= elem.added;\n\t\t\t\t}\n\t\t\t\tif(elem instanceof THREE.AmbientLight){\n\t\t\t\t\telem.color.addScalar(v);\n\t\t\t\t}\n\t\t\t\telem.added = value;\n\t\t\t}\n\t\t);\n\t\tmodule.exports.render();\n\t},\n\n\tsetFog: function(distance){\n\t\tfogDistance = distance;\n\t\tif(scene && scene.fog){\n\t\t\tscene.fog.far = distance;\n\t\t\tscene.fog.near = Math.max(1,distance - cameraOpts.foglength);\n\t\t}\n\t\tif(camera){\n\t\t\tcamera.far = distance;\n\t\t\tcamera.updateProjectionMatrix();\n\n\t\t\t/// Update terrain material\n\t\t\tterrainChunks.forEach(function(mesh){\n\t\t\t\tmesh.material.uniforms[\"fogNear\"].value = scene.fog.near;\n\t\t\t\tmesh.material.uniforms[\"fogFar\"].value = scene.fog.far;\n\t\t\t\tmesh.material.needsUpdate = true;\n\t\t\t})\n\t\t}\n\t\tthis.render();\n\t\t\n\t},\n\n\tshowProgressPanel: function(cb){\n\t\tvar pp = $(\"#progressPanel\");\n\n\t\tif(pp.is(\":visible\")){\n\t\t\tif(cb)\n\t\t\t\tcb();\n\t\t\treturn;\n\t\t}\n\n\t\tpp.find(\".title\").html(\"Loading\");\n\t\tpp.find(\".progress\").html(\"...\");\n\n\t\tthis.showPanel(pp, cb);\n\t},\n\n\tshowMapPanel: function(cb){\n\t\tthis.showPanel($(\"#mapPanel\"), cb);\n\t},\n\n\tshowPanel: function(panelIn, cb){\n\t\tvar currentPanel = $(\"#output\").find(\".ui-panel:visible\");\n\n\t\tthis.swapPanels(currentPanel, panelIn, true, cb);\n\t\t/*panelIn.css({left:\"auto\",right:\"auto\"});\n\t\tpanelIn.siblings().addClass(\"hidden\");\n\t\tpanelIn.removeClass(\"hidden\");*/\n\t},\n\n\tswapPanels: function(panelOut, panelIn, dir, cb){\n\t\tvar t = 400 * 0;\n\t\tvar ease = \"swing\";\n\n\t\t/// Fix height\n\t\tpanelOut.parent().css({height:panelOut.parent().height()});\n\t\tpanelIn.removeClass(\"hidden\");\n\t\tvar h = panelIn.height();\n\t\tpanelIn.addClass(\"hidden\");\n\n\n\t\t/// Set slide in start values\n\t\tpanelIn.css({right:dir?-500:'auto', left:dir?'auto':-500});\n\n\t\t\n\t\t/// Current element slide out\n\t\tpanelOut.css({right:dir?-500:'auto'});\n\n\t\tvar animateOutProp, animateInProp;\n\t\tif(dir){\n\t\t\tanimateOutProp = {left:-500};\n\t\t\tanimateInProp = {right:0};\n\t\t}\n\t\telse{\n\t\t\tanimateOutProp = {right:-500};\n\t\t\tanimateInProp = {left:0};\n\n\t\t}\n\n\t\tpanelOut.animate(animateOutProp, t, ease, function(){\n\n\t\t\t/// Hide Current element\n\t\t\tpanelOut.addClass(\"hidden\");\n\n\t\t\t/// Parent height\n\t\t\tpanelOut.parent().animate({height:h}, t/2.0, ease, function(){\t\t\t\n\n\t\t\t\t/// Slide in next element\n\t\t\t\tpanelIn.removeClass(\"hidden\");\n\t\t\t\tpanelIn.animate(animateInProp, t, ease, cb);\n\n\t\t\t});\n\n\t\t});\n\t},\n\n\tgetScene: function(){ return scene; },\n\tgetSkyScene: function(){ return skyScene; },\n\tgetCamera: function(){ return camera; },\n\tgetRenderer: function(){ return renderer; },\n\tgetCollisions: function(){ return collisions; },\n\tgetNonCollisions: function(){ return nonCollisions; },\n\tgetTerrainChunks: function(){ return terrainChunks; },\n\tgetSkyObjects: function(){ return skyObjects; },\n\tgetLights: function(){ return lights; }\n}; \n","///  ----- Includes  ----- \nvar UI =  require(\"./UI.js\");\nvar SceneUtils = require(\"./SceneUtils.js\");\nvar FlyControls =  require(\"./FlyControls.js\");\n\n\n/**\n * Tyria 3D Web application\n * \n * The tyria3d.com web UI\n *\n * @main Tyria3DApp\n * @class Tyria3DApp\n * @static \n */\nvar Tyria3DApp = module.exports = function() {\n\n\tthis.map;\n\tthis.stats;\n\tthis.controller;\n\tthis.hasPointerLock;\n\tthis.ui;\n\n\tthis.lastTs = -1;\n\tthis.animating = false;\n\tthis.localReader = null;\n\tthis._mapRect = null;\n\n\tthis.animationTime = 350 * 0;\n\n\t/// Run UI stuff when document is rdy\n\t$(document).ready(this.onDocumentReady.bind(this));\n\n\t/**\n\t * @method initAnim\n\t */\n\tthis.initAnim = function(){\n\t\tvar self =  this;\n\t\t$(\".content  h1\").first().animate({\"margin-top\":20}, self.animationTime);\n\t\t$(\"nav\").slideUp(self.animationTime,function(){\n\t\t\t$(\"#intro\").delay(self.animationTime).fadeOut(self.animationTime,self.init.bind(self));\n\t\t});\n\t}\n\n\t/**\n\t * @method init\n\t */\n\tthis.init = function(){\n\t\tvar self = this;\n\n\t\t// Hide intro div\n\t\t$(\"#intro\").hide();\t\n\n\t\t/// Add stats (toggled by pressing \"i\")\n\t\tthis.stats = new Stats();\n\t\t$(\"body\").append( this.stats.domElement );\n\n\t\t/// Create fly controls, initare after UI DOM has been added.\n\t\tthis.controller = new FlyControls();\n\n\t\t/// Set up UI\n\t\tthis.ui = new UI( $(\"body\"), this.controller, this.loadMap.bind(self) );\n\t\tthis.ui.init();\n\n\t\t/// Create file picker, used to pick DAT file\n\t\tvar filePicker = $(\"<input type='file' class='hidden' />\");\n\t\tvar fileIcon = $(\"<button id='fileInputIcon' tabindex='-1'>Select a Guild Wars 2 .dat file</button>\");\n\t\tfileIcon.click(function () {\n\t\t    filePicker.trigger('click');\n\t\t});\n\t\t\n\t\t/// .dat file received from the file input, entry point!\n\t\tvar onReceiveFile = function(evt){\n\t\t\t\n\t\t\t/// Get loaded file reference from event\n\t\t\t///TODO: Check file length etc.\n\t\t\tvar files = evt.target.files;\n\t\t\tvar file = files[0];\n\n\t\t\tfilePicker.val('');\n\t\t\t\n\t\t\t/// Get a local reader\n\t\t\tself.localReader = T3D.getLocalReader(file, function(){\n\t\t\t\t\n\t\t\t\t/// Get the maps in the dat and put them in the UI.\n\t\t\t\t/// Show progress panel during load.\n\t\t\t\tSceneUtils.showProgressPanel(function(){\t\t\n\t\t\t\n\t\t\t\t\t$(\"#output\").find(\".title\").html(\"Finding maps (first visit only)\");\n\t\t\t\t\t$(\"#output\").find(\".progress\").html(\"initializing\");\n\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\tT3D.getMapListAsync(self.localReader, self.applyMapList, false);\n\t\t\t\t\t},10);\n\t\t\t\t});\n\t\t\t}, undefined, undefined, \"js/T3D/t3dworker.js\");\n\n\t\t\t// SAVE MAP CODE WAS HERE\n\n\t\t};\n\n\t\t/// Add listener to file input\n\t\tfilePicker.change(onReceiveFile);\n\n\t\t/// Append file input elements to the DOM\n\t\t$(\"#filePanel\").append(filePicker);\n\t\t$(\"#filePanel\").append(fileIcon);\n\n\t\t/// Build deep map search interface\n\t\tvar deepSearchButton = $(\"<span class='link'>Scan all .dat entries for maps</span>\");\n\t\tdeepSearchButton.click( function(evt){\n\t\t\tif ( confirm(\n\t\t\t\t\t\"Searching the full .dat file will take roughly 10 minutes depending on file size.\\n\\n\"+\n\t\t\t\t\t\"Once complete the results will be stored locally and available every time you load this .dat.\\n\\n\"+\n\t\t\t\t\t\"Note that the vast majority of maps are probably already loaded.\"+\n\t\t\t\t\t\"Are you sure you want to search the .dat for maps?\"\n\t\t\t\t) ) {\n\n\t\t\t\tSceneUtils.showProgressPanel(function(){\t\t\n\t\t\t\n\t\t\t\t\t$(\"#output\").find(\".title\").html(\"Finding maps (first visit only)\");\n\t\t\t\t\t$(\"#output\").find(\".progress\").html(\"initializing\");\n\n\t\t\t\t\tsetTimeout(function(){\n\t\t\t\t\t\t\tT3D.getMapListAsync(self.localReader, self.applyMapList, true);\n\t\t\t\t\t},10);\n\t\t\t\t});\n\t\t\t\t\n\t\t\t}\n\t\t\t\n\t\t} );\n\n\t\t/// Append deep search elements to the DOM\n\t\tvar searchParagraph = $(\"<p class='instruction'>Missing maps? </p>\");\n\t\tsearchParagraph.append(deepSearchButton);\n\t\t$(\"#mapPanel\").append(searchParagraph);\n\n\t\t/// Key listeners connected to UI (toggle UI panel and stats)\n\t\tdocument.addEventListener( 'keydown', this.keyDownListener, false );\n\t\tdocument.addEventListener('mousewheel',this.mouseWheelListener, false); \n\n\t\t/// Set up scene holding visible objects, lights, camera and renderer.\n\t\tSceneUtils.setupScene();\n\n\t\t/// Keep rendered hidden until map is ready to render.\n\t\tSceneUtils.setRenderVisible(false);\n\t\t\n\t\t/// Initiate controlls, connection them to the scene.\n\t\tthis.hasPointerLock = this.controller.init();\n\n\t};\n\n\n\n\t/**\n\t * Called when a map is specified via the drop down\n\t * @method loadMap\n\t * @param  {[type]} fileName [description]\n\t * @param  {[type]} absolute [description]\n\t * @return {[type]}          [description]\n\t */\n\tthis.loadMap = function(fileName, absolute){\n\n\t\tvar self = this;\n\n\t\t/// Pop up the progres panel\n\t\tSceneUtils.showProgressPanel(function(){\n\n\t\t\t/// Disable controller and hide rendered during load\n\t\t\tself.controller.setMapReady(false);\n\t\t\tSceneUtils.setRenderVisible(false);\n\n\t\t\t/// Set up renderers\n\t\t\tvar renderers = [\n\t\t\t\t{\n\t\t\t\t\trenderClass: T3D.HavokRenderer,\n\t\t\t\t\tsettings:{\n\t\t\t\t\t\tvisible: $(\"#showHavok\")[0].checked\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\trenderClass: T3D.EnvironmentRenderer,\n\t\t\t\t\tsettings:{}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\trenderClass: T3D.TerrainRenderer,\n\t\t\t\t\tsettings:{\n\t\t\t\t\t\tanisotropy : SceneUtils.getRenderer().getMaxAnisotropy()\n\t\t\t\t\t}\n\t\t\t\t}\t\t\t\t\n\t\t\t];\n\n\t\t    if( $('#loadZone').prop(\"checked\") ){\n\t\t    \trenderers.push({\n\t\t    \t\trenderClass: T3D.ZoneRenderer,\n\t\t    \t\tsettings:{}\n\t\t    \t});\n\t\t    }\n\t\t    if( $('#loadProp').prop(\"checked\") ){\n\t\t    \trenderers.push({\n\t\t    \t\trenderClass: T3D.PropertiesRenderer,\n\t\t    \t\tsettings:{}\n\t\t    \t});\n\t\t    }\n\n\t\t\t/// Call map renderer in order to get all 3d objects\n\t\t\tT3D.renderMapContentsAsync(self.localReader, fileName, renderers, self.onMapLoaded.bind(self));\n\n\t\t});\t\n\t}\n\n\t/**\n\t * Callback to transfer the parsed data to three-js\n\t * @return {void}\n\t */\n\tthis.onMapLoaded = function(mapData){\n\t\t/// Clear scene\n\t\tSceneUtils.clear();\n\n\t\t//ZoneRenderer\n\t\tif(mapData.ZoneRenderer != undefined){\n\t\t\tmapData.ZoneRenderer.meshes.forEach(function(elem){\n\t\t\t\tSceneUtils.getScene().add(elem); //Visible\n\t\t\t\tSceneUtils.getNonCollisions().push(elem);\n\t\t\t});\t\n\t\t}\n\n\t\t//PropertiesRenderer\n\t\tif(mapData.PropertiesRenderer != undefined){\n\t\t\tmapData.PropertiesRenderer.meshes.forEach(function(elem){\n\t\t\t\tSceneUtils.getScene().add(elem); //Visible\n\t\t\t\tSceneUtils.getNonCollisions().push(elem);\n\t\t\t});\t\n\t\t}\n\n\t\tmapData.EnvironmentRenderer.skyElements.forEach(function(elem){\n\t\t\tSceneUtils.getSkyScene().add(elem);\n\t\t\tSceneUtils.getSkyObjects().push(elem);\n\t\t});\t\t\n\t\t\n\t\t/// Add terrain tiles to a special list\n\t\t/// ( these need their fog updated in a specific way ).\n\t\tmapData.TerrainRenderer.terrainTiles.forEach(function(elem){\n\t\t\tSceneUtils.getScene().add(elem); //Visible\n\t\t\tSceneUtils.getTerrainChunks().push(elem); //Terrain\n\t\t\tSceneUtils.getCollisions().push(elem); //Collision\n\t\t});\t\n\n\t\tSceneUtils.getScene().add(mapData.TerrainRenderer.water);\n\t\tSceneUtils.getNonCollisions().push(mapData.TerrainRenderer.water); //Water\n\n\t\t/// Add all collisions to a special list\n\t\tif(mapData.HavokRenderer != undefined){\n\t\t\tmapData.HavokRenderer.meshes.forEach(function(elem){\n\t\t\t\tSceneUtils.getScene().add(elem);\n\t\t\t\tSceneUtils.getCollisions().push(elem);\n\t\t\t});\n\t\t}\n\n\t\t/// Add lights\n\t\tmapData.EnvironmentRenderer.lights.forEach(function(elem){\n\t\t\tSceneUtils.getScene().add(elem);\n\t\t\tSceneUtils.getLights().push(elem);\n\t\t});\n\n\t\t/// Set haze color \n\t\tvar hazeColor = mapData.EnvironmentRenderer.hazeColor;\n\t\tvar color = new THREE.Color(hazeColor[2]/255.0, hazeColor[1]/255.0, hazeColor[0]/255.0);\n\t\tSceneUtils.getRenderer().setClearColor( color, 1.0 );\n\t\tSceneUtils.getScene().fog.color.copy(color);\n\n\t\t/// Store bounds locally in order to display orto cam correctly\n\t\t_mapRect = mapData.TerrainRenderer.bounds;\n\n\t\t/// Enable UI\n\t\tthis.controller.setMapReady(true);\n\t\t$(\"#UI\").removeClass(\"hidden\");\n\n\t\t/// Set ambient light slider to 50% if there were no parsed lights in the map data.\n\t\t$(\"#ambientSlider\").slider(\"value\",mapData.EnvironmentRenderer.hasLight ? 0 : 0.5);\n\n\t\t/// Set view dist after all objects are in place\n\t\t$(\"#fogSlider\").slider(\"value\",35000);\n\n\t\t/// Data Renderer is done start animating!\n\t\tif(this.hasPointerLock){\n\t\t\tSceneUtils.showPanel($(\"#suspendedPanel\"));\n\t\t}\n\t\telse{\n\t\t\tSceneUtils.showPanel($(\"#errorPanel\"));\n\t\t}\n\t\t\n\t\t/// Set camera position\n\t\tvar controls = this.controller.getControls();\n\t\tcontrols.getObject().position.set(0, mapData.TerrainRenderer.bounds ? mapData.TerrainRenderer.bounds.y2 : 0, 0);\n\t\tcontrols.getPitchObject().rotation.x = -Math.PI/2;\t\t\n\n\t\t// Initial render, indep. of controller being active\n\t\tSceneUtils.render();\n\n\t\t// Show canvas\n\t\tSceneUtils.setRenderVisible(true);\n\n\t\t/// Animate scene\n\t\tif(!this.animating){\n\t\t\tthis.animating = true;\n\t\t\tthis.animate(0);\t\n\t\t}\n\n\n\t}//End onload callback\n\n\n\t/**\n\t * @method  applyMapList\n\t * @param  {[type]} mapList [description]\n\t * @return {[type]}         [description]\n\t */\n\tthis.applyMapList = function(mapList){\n\n\t\t/// Update picker elements\n\t\tvar picker = $(\"#mapPicker\");\n\t\tpicker.empty();\n\t\tpicker.append($(\"<option selected='true' disabled='disabled'>Pick Map</option>\")); \n\t\t\n\n\t\tvar compareName = function(a, b) {\n\t\t\tif (a.name < b.name)\n\t\t\t    return -1;\n\t\t\tif (a.name > b.name)\n\t\t\t    return 1;\n\t\t\treturn 0;\n\t\t};\n\n\t\tmapList.maps.sort(compareName);\n\t\t\n\t\tmapList.maps.forEach(function(g){\n\t\t\tvar group = $(\"<optgroup label='\"+g.name+\"' />\");\n\t\t\tpicker.append(group);\n\n\t\t\tg.maps.sort(compareName);\n\t\t\tg.maps.forEach(function(m){\n\t\t\t\tgroup.append(\"<option value='\"+m.fileName+\"'>\"+m.name+\"</option>\");\n\t\t\t});\n\t\t\t\n\t\t});\n\n\t\tSceneUtils.showMapPanel();\t\t\n\t}\n\n\tthis.mouseWheelListener = function(evt){\n\t\tvar dir = Math.sign(evt.wheelDelta);\n\t\tvar s = $(\"#moveSpeedSlider\");\n\t\tvar min =  s.slider(\"option\",\"min\")\n\t\tvar max = s.slider(\"option\",\"max\") \n\t\tvar range =max - min;\n\t\t\n\t\tvar val = range*dir*0.05 + s.slider( \"option\", \"value\" );\n\t\tval = Math.min(max,val);\n\t\tval = Math.max(min,val);\n\n\t\ts.slider(\"option\", \"value\", val);\n\t}\n\n\t/**\n\t * Main \"game\" loop, called trough requestAnimationFrame\n\t * @param  {[type]} timestamp [description]\n\t * @return {[type]}           [description]\n\t */\n\tthis.animate = function(timestamp) {\n\t\t\n\t\t/// Get time step\n\t\tvar delta = timestamp - this.lastTs;\n\t\tif(delta > 0){\n\t\t\t\n\t\t\tthis.lastTs = timestamp;\n\n\t\t\t/// Update current controller\n\t\t\tif( this.controller.update(delta*0.001) ){\n\n\t\t\t\t/// If controller returns true, render\n\t\t\t\tSceneUtils.render();\n\t\t\t}\n\n\t\t\t/// Update stats (FPS etc)\n\t\t\tthis.stats.update();\n\n\t\t}\n\n\t\twindow.requestAnimationFrame( this.animate.bind(this) );\n\t}\n\n\t/**\n\t * Settings and debugging key listener\n\t * @method keyDownListener\n\t * @param  {[type]} evt [description]\n\t * @return {[type]}     [description]\n\t */\n\tthis.keyDownListener = function(evt){\n\t\tif(evt.keyCode == 85){ // U\n\t\t\t$(\"#UI\").toggle();\n\t\t\tSceneUtils.resize();\n\t\t}\n\t\tif(evt.keyCode == 73){ // I\n\t\t\t$(\"#stats\").toggle();\n\t\t}\n\t\tif(evt.keyCode == 80){ // P\n\t\t\tSceneUtils.setPerspective();\n\t\t}\n\t\tif(evt.keyCode == 79){ // O\n\n\t\t\tvar r = _mapRect;\n\t\t\tif(r){\n\t\t\t\tvar xMin = r.x1;\n\t\t\t\tvar xMax = r.x2;\n\t\t\t\tvar yMin = r.y1;\n\t\t\t\tvar yMax = r.y2;\n\t\t\t\tSceneUtils.setOrthographic(xMin, xMax, yMin, yMax, 100000, -100000);\n\t\t\t}\n\t\t}\n\t\tif(evt.keyCode == 70){ // F\n\t\t\t$(\"#flyInput\").trigger('click');\n\t\t}\n\t}\n\n}\n\n\nTyria3DApp.prototype.onDocumentReady = function(){\n\n\tconsole.log(\"Tyria 3D API version \"+T3D.version);\n\tvar self = this;\n\n\t/// Detect Chrome and WebGL\n\t//var is_chrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;\n\tvar hasWebGL = T3D.hasWebGL();\n\n\t/// Hide blinking loader\n\t$(\"#frontpageLoader\").addClass(\"hidden\");\n\n\t/// Display error message for missing WebGL\n\tif (!window.WebGLRenderingContext || !hasWebGL) {\n    \t$(\"#errorGL\").removeClass(\"hidden\");\n  \t}\n\n  \t/// Display error message for non-Chrome browsers\n  \t// else if(!is_chrome){\n  \t// \t$(\"#errorChrome\").removeClass(\"hidden\");\n  \t// }\n\n  \t/// If everyting is ok, enable the button that shows the file picker.\n  \telse{\n\t\t$(\"#ILoveYouDiddi\").removeClass(\"hidden\").one(\"click\",self.initAnim.bind(self));\n  \t}\n}\n\n/// Starting point\nvar App = new Tyria3DApp();","//var T3D = require(\"../../../vendor/T3D/T3D-1.0.3.js\");\nvar SceneUtils = require(\"./SceneUtils\");\n\nvar tShort = 200 * 0;\nvar tLong = 500 * 0;\n\n\nvar UI = function(holder, controller, loadMap){\n\tthis.holder = holder;\n\tthis.controller = controller;\n\tthis.loadMap = loadMap;\n};\n\nUI.prototype.selectMap=function(mapListObject){\n\t$(\"#mapPicker option\").filter(function() {\n\t    return $(this).val() == mapListObject.fileName; \n\t}).prop('selected', true);\n\t$(\"#mapPicker\").change();\n};\n\nUI.prototype.logProgress = function(){\n\tif(!UI.op)\n\t\tUI.op = $(\"#output\");\n\t\n\t/// Hack to keep the message about first time up.\n\tif( arguments[0] != \"Find type\")\n\t\tUI.op.find(\".title\").html(arguments[0]);\n\n\tif(parseFloat(arguments[1])){\n\t\tUI.op.find(\".progress\").html(arguments[1]+\"%\");\t\n\t}\n\telse{\n\t\tUI.op.find(\".progress\").html(arguments[1]);\t\n\t}\n\t\n}\n\nUI.prototype.init=function(){\n\tvar self = this;\n\n\t/// Connect to T3D\n\tT3D.Logger.logFunctions[T3D.Logger.TYPE_PROGRESS] = this.logProgress;\n\tT3D.Logger.logFunctions[T3D.Logger.TYPE_DEBUG] = function(){};\n\n\t/// Main UI\n\tvar $UI = $(\"<div id='UI' class='diagonalBG hidden' />\");\n\t\n\tthis.holder.append($UI);\n\n\t\n\n\t/// Messages output\n\tvar outputWrapper = $(\"<div id='outputWrapper'/>\");\n\toutputWrapper.css({top:-500}).delay(tShort).animate({top:0},tLong);\n\tvar output = $(\"<div id='output' class='diagonalBG'/>\");\n\t//output.append(\"1. Load a Guild Wars 2 .dat file<br/><br/>2. Pick a map from the drop down menu\");\n\toutputWrapper.append(output);\n\tthis.holder.append(outputWrapper);\n\n\t/// File picker\n\toutput.append($(\n\t\t\"<div class='ui-panel' id='filePanel'>\"+\n\t\t\"<p class='title'>\"+\n\t\t\"<span class='titleLink homeLink'>Home</span>\"+\n\t\t\"<span class='titleSeparator'> &#187 </span>\"+\n\t\t\"File\"+\n\t\t\"<span class='titleSeparator'> &#187 </span>\"+\n\t\t\"<span class='titleInactive'>Map</span>\"+\n\t\t\"</p>\"+\n\t\t\"<p class='instruction'>\"+\n\t\t\t\"Tyria 3D reads data from the Guild Wars 2 <span class='hightlight'>.dat file</span>. This file contains all the assets used to run the game and is located\"+\n\t\t\t\" in the Guild Wars 2 install directory, the same directory that the game executable is located in.\"+\n\t\t\"</p>\"+\n\t\t\"</div>\"\n\t));\n\n\n\t// Progress and mesages\n\tvar progressOutput = $(\"<div class='ui-panel hidden' id='progressPanel'>\"+\n\t\t\"<p class='title'/>\"+\t\n\t\t\"<p class='progress'/>\"+\t\n\t\t\"</div>\");\n\toutput.append(progressOutput);\n\n\tvar errorOutput = $(\"<div class='ui-panel hidden' id='errorPanel'>\"+\n\t\t\"Your browser doesn\\'t seem to support Pointer Lock API, \"+\n\t\t\"navigating the map will not be possible.<br/><br/>Pro tip: \"+\n\t\t\"<a href='https://www.google.com/chrome/browser/desktop/index.html' target='_blank'>\"+\n\t\t\"Donwload Google Chrome</a>.\"+\n\t\t\"</div>\");\n\toutput.append(errorOutput);\n\n\tvar suspendedPanel = $(\"<div class='ui-panel hidden' id='suspendedPanel'>\"+\n\t\t\t\"This view is suspended until you<br/><br/> \"+\n\t\t\t\"<strong>click and hold</strong> to look around<br /><br/>\"+\n\t\t\t\"or<br/><br />click the <strong>Lock Mouse</strong> button<br/><br/>\"+\n\t\t\t\"When this view is active, use <strong>W A S D</strong> and <strong>space</strong> to move and jump + air jump\"+\n\t\t\"</div>\");\n\toutput.append(suspendedPanel);\n\n\n\t// Map opts\n\tvar mapOpts = $(\"<div class='ui-panel hidden' id='mapPanel'>\"+\n\t\t\"<p class='title'>\"+\n\t\t\"<span class='titleLink homeLink'>Home</span>\"+\n\t\t\"<span class='titleSeparator'> &#187 </span>\"+\n\t\t\"<span id='mapBack' class='titleLink'>File</span>\"+\n\t\t\"<span class='titleSeparator'> &#187 </span>\"+\n\t\t\"Map\"+\n\t\t\"</p>\"+\n\t\t\"<p class='instruction' style='margin-bottom:0;'>\"+\n\t\t\t\"Select what data to load and pick a <span class='highlight'>Map</span>.\"+\n\t\t\"</p>\"+\t\t\n\t\t\"</div>\");\n\n\toutput.append(mapOpts);\n\n\t$(\"#mapBack\").click(function(evt){\n\t\tSceneUtils.swapPanels($(\"#mapPanel\"), $(\"#filePanel\"));\n\t});\n\n\t$(\".homeLink\").click(function(){\n\t\tlocation.reload();\n\t});\n\n\n\n\n\t/// UI to select what to load\n\tmapOpts.append($(\n\t\t\n\t\t\t\"<label class='noselect'>\"+\n\t\t\t\t\"<p class='label'>Zone Models</p>\"+\n\t\t\t\t\"<input type='checkbox' id='loadZone' tabindex='-1' />\"+\n\t\t\t\"</label>\"+\n\t\t\t\"<label class='noselect '>\"+\n\t\t\t\t\"<p class='label'>Prop Models</p>\"+\n\t\t\t\t\"<input type='checkbox' id='loadProp' tabindex='-1' checked='checked' />\"+\n\t\t\t\t//\"<input type='checkbox' id='loadProp' tabindex='-1' />\"+\n\t\t\t\"</label>\"+\n\t\t\t\"<label class='noselect '>\"+\n\t\t\t\t\"<p class='label'>Visible collision</p>\"+\n\t\t\t\t\"<input type='checkbox' id='showHavok' tabindex='-1' />\"+\n\t\t\t\"</label><br/>\"\n\t));\n\n\t\n\t/// UI to pick map file\n\tvar picker = $(\"<select id='mapPicker' tabindex='-1'/>\");\n\tpicker.append($(\"<option selected='true' disabled='disabled'>No .dat loaded</option>\")); \n\t\n\t\n\tT3D.MapFileList.maps.forEach(function(g){\n\t\tvar group = $(\"<optgroup label='\"+g.name+\"' />\");\n\t\tpicker.append(group);\n\t\tg.maps.forEach(function(m){\n\t\t\tgroup.append(\"<option value='\"+m.fileName+\"'>\"+m.name+\"</option>\");\n\t\t});\n\t\t\n\t});\n\t\n\n\tpicker.change(function(evt){\n\t\tvar val = picker.val()\n\t\tself.loadMap(val);\n\n\t\tvar label = $(\"#mapPicker option\").filter(function() {\n\t    \treturn $(this).val() == val; \n\t\t}).html();\n\t\t$(\"#mapTitle\").html(label);\n\n\n\t\tpicker.blur();\n\t});\n\tmapOpts.append(picker);\t\n\n\n\tmapOpts.append( $(\"<p class='instruction'>\"+\n\t\t\t\"Enabling <span class='highlight'>Zone Models</span> allows you to view trees, plants and various 'nature' models. \"+\n\t\t\n\t\t\"</p><p class='instruction'>\"+\n\t\t\t\"Enabling <span class='highlight'>Prop Models</span> allows you to view most of the models in a map. \"+\n\t\t\n\t\t\"</p><p class='instruction'>\"+\t\n\t\t\t\"Enabling <span class='highlight'>Visible collision</span> allows you to view all the collision data in a map. \"+\n\t\t\t\" The collision data has no textures but will give you a hint of how the map looks with actual models,\"+\n\t\t\t\" consider enabling only Visible collision to reduce map loading times. \"+\n\t\t\t\" If you enabled Zone Models or Prop Models you probably don't want Visible collision.\"+\n\t\t\"</p>\") );\n\n\t/// END Map Picker\n\n\n\t// Move opts\n\tvar movementOpts = $(`<div class='ui-panel' id='optionsPanel'>\n\t\t\t<p class='title' id='mapTitle'></p>\n\t\t\t<p id='showMapSelection' class='optionsLink' tabindex='-1'>Back to map selection</p>\n\t\t\t\n\t\t\t<div>\n\t\t\t\t<br/>\n\t\t\t\t<span class='label'>View distance:</span><br/>\n\t\t\t\t<div class='slider' id='fogSlider' tabindex='-1'></div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div>\n\t\t\t\t<span class='label'>&#128161;:</span>\n\t\t\t\t<div class='slider' id='ambientSlider' tabindex='-1'></div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div>\n\t\t\t\t<span class='label'>Speed [Scroll Up/Down]:</span>\n\t\t\t\t<div class='slider' id='moveSpeedSlider' tabindex='-1'></div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div>\n\t\t\t\t<span class='label'>Mouse sensitivity:</span>\n\t\t\t\t<div class='slider' id='mouseSensSlider' tabindex='-1'></div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div>\n\t\t\t\t<label class='noselect halfLabel'><p class='label'>Fly [F]</p>\n\t\t\t\t<input id='flyInput' type='checkbox' tabindex='-1' checked='checked'></input></label>\n\t\t\t\t<label class='noselect halfLabel'><p class='label'>Invert mouse</p>\n\t\t\t\t<input id='invertInput' type='checkbox' tabindex='-1'></input></label>\n\t\t\t</div>\n\t\t\t\n\t\t\t<p class='uiText'>Toggle UI [U], Toggle Stats [I], Orthographic Cam [O], Perspective Cam [P]</p>\n\t\t\t<button id='mouseLockBtn' tabindex='-1'>Lock Mouse</button>\n\t\t\t\n\t\t\t\n\t\t\t<label class='hidden'><p class='label nomargin'>Location URL</p>\t\n\t\t\t<input class='hidden' id='locationInput' type='text'></input></label>\t\n\t\t</div>`);\n\n    $UI.append(movementOpts);\n\n    $(\"#showMapSelection\").click(function(){\n    \t$(\"#UI\").addClass(\"hidden\");\n    \tself.controller.setMapReady(false);\n    \tSceneUtils.swapPanels($(\"#suspendedPanel\"),$(\"#mapPanel\"));\n    \t$(\"canvas\").hide();\n    \t$(\"#mapPicker option\").prop('selected', false);\n    \t$(\"#mapPicker option\").first().prop('selected', true);\n    });\n\n    function onSpeedChange(evt, ui){\n    \tvar speed = Math.exp(ui.value);\n    \twindow.setTimeout(function(){\n    \t\tself.controller.setSpeed(speed);\t\n    \t},10);\t\n    }\n\n    function onSensChange(evt, ui){\n    \tvar sens = ui.value;\n    \twindow.setTimeout(function(){\n    \t\tself.controller.setSensitivity(sens);\n    \t},10);\n    }\n\n    function onFogChange(evt, ui){\n    \tSceneUtils.setFog(ui.value);\n    }\n\n    function onAmbientChange(evt, ui){\n    \tSceneUtils.setAmbientAdd(ui.value);\n    }\n\n    function onLightChange(evt, ui){\n    \twindow.setTimeout(function(){\n    \t\tSceneUtils.setHSLa(\n    \t\t\t0.27,\n    \t\t\t$(\"#saturationSlider\").slider(\"option\", \"value\"),\n    \t\t\t$(\"#lightnessSlider\").slider(\"option\", \"value\"),\n    \t\t\t$(\"#intensitySlider\").slider(\"option\", \"value\")\n\t\t\t);\n    \t\tSceneUtils.render();\n    \t},10);\n    }\n\n    \n\n    /// Sliders\n    $(\"#moveSpeedSlider\").slider({\n\t\tmin: 4, max: 10, step: 0.01,\n  \t\tchange: onSpeedChange\n    }).slider(\"value\",7.5);\n\n    $(\"#mouseSensSlider\").slider({\n\t\tmin: 0.0001, max: 0.01, step: 0.0001,\n  \t\tchange: onSensChange\n    }).slider(\"value\",0.002);\n    \n    $(\"#fogSlider\").slider({\n\t\tmin: 5000, max: 100000, step: 500,\n  \t\tchange: onFogChange\n    });\n\n    $(\"#ambientSlider\").slider({\n\t\tmin: 0, max: 1.0, step: 0.01,\n  \t\tchange: onAmbientChange\n    });\n\n    /// HSL\n    /*$(\"#saturationSlider\").slider({\n\t\tmin: 0, max: 1, step: 0.01,\n  \t\tchange: onLightChange\n    }).slider(\"value\",0.4);\n    $(\"#intensitySlider\").slider({\n\t\tmin: 0, max: 1, step: 0.01,\n  \t\tchange: onLightChange\n    }).slider(\"value\",0.5);\n    $(\"#lightnessSlider\").slider({\n\t\tmin: 0, max: 1, step: 0.01,\n  \t\tchange: onLightChange\n    }).slider(\"value\",0.5);*/\n\n    /// END Sliders\n\n\n    /// Toggle buttons\n    $(\"#invertInput\").change(function(){\n    \tself.controller.invertMouse();\n    })\n    $(\"#flyInput\").change(function(){\n    \t\n    \t/*if($(this).is(':checked'))\n    \t\t$(\"#fogSlider\").slider(\"value\",35000);\n    \telse \n    \t\t$(\"#fogSlider\").slider(\"value\",15000);*/\n    \t\t\n    \tself.controller.toggleFly();\n    })\n\n    $(\"#mouseLockBtn\").click(function(){\n    \tself.controller.lock();\n    });\n\n    /// END Toggle buttons\n\t$(\"#locationInput\").on('click',function(){ this.select(); });\n\n    // Instructions \n\t/*var instructions = $(\"<div class='ui-panel'>\"+\n\t\t\"<p class='title'>Instructions</p>\"+\n\t\t\"<p class='instruction'>Pick a map from the drop down menu.</p>\"+\n\t\t\"<p class='instruction'><strong>Click and hold</strong> to look around. \"+\n\t\t\"Use <strong>W A S D</strong> and <strong>space</strong> to move.</p>\"+\n\t\t\"<p class='instruction'>Enable experimental downward collision by unchecking <strong>fly</strong>.</p>\"+\n\t\t\"<p class='instruction'>Toggle this panel with <strong>U</strong>.</p>\"+\n\t\"</div>\");\n\t$UI.append(instructions);*/\n};\n\n\nmodule.exports = UI;"]}