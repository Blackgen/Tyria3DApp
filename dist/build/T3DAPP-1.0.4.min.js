!function a(s,r,l){function c(n,e){if(!r[n]){if(!s[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(d)return d(n,!0);var i=new Error("Cannot find module '"+n+"'");throw i.code="MODULE_NOT_FOUND",i}var o=r[n]={exports:{}};s[n][0].call(o.exports,function(e){var t=s[n][1][e];return c(t||e)},o,o.exports,a,s,r,l)}return r[n].exports}for(var d="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){var a,s,r=e("./SceneUtils"),l=new THREE.Vector3,c=!1,d=!1,p=!1,u=!1,h=!1,o=!1,m=500,f=!0,g=!1,i=function(){};i.prototype.updateURL=function(){var e=s.getObject().position,t=Math.round(1e4*s.getPitchObject().rotation.x)/1e4,n=Math.round(1e4*s.getObject().rotation.y)/1e4,i=$("#mapPicker").val();$("#locationInput").val(window.location.href.split("#")[0]+"#"+i+","+Math.round(1e3*e.x)/1e3+","+Math.round(1e3*e.y)/1e3+","+Math.round(1e3*e.z)/1e3+","+t+","+n)},i.prototype.getControls=function(){return s},i.prototype.setSpeed=function(e){m=e},i.prototype.toggleFly=function(){f=!f},i.prototype.setSensitivity=function(e){s.setSensitivity(e)},i.prototype.invertMouse=function(){s.invertMouse()},i.prototype.update=function(e){if(s.enabled){var t=s.getObject().position.y<0;if(f||t){var n=s.getObject();if(l.x=0,l.y=0,l.z=0,d||p){var i=d?m:-m;s.getDirection(l),l.normalize(),l.multiplyScalar(i),n.position.set(n.position.x+l.x*e,n.position.y+l.y*e,n.position.z+l.z*e)}if(u||h){i=h?m:-m;n.translateX(i*e)}c&&s.getObject().translateY(m*e)}else{var o;if(l.z=d?-m:p?m:0,l.x=u?-m:h?m:0,a.ray.origin.copy(s.getObject().position),o=a.intersectObjects(r.getCollisions()),!0===0<o.length){l.y=Math.max(0,l.y);s.getObject().translateY(70-o[0].distance-1)}else l.y-=2*m*e;s.getObject().translateX(l.x*e),s.getObject().translateY(l.y*e),s.getObject().translateZ(l.z*e)}return!0}return!1},i.prototype.lock=function(){var e=document.body;e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock()},i.prototype.setMapReady=function(e){g=e},i.prototype.init=function(){if(!("pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document))return!1;var t=this,n=document.body;document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;var e=function(e){g&&(document.pointerLockElement===n||document.mozPointerLockElement===n||document.webkitPointerLockElement===n?(controlsEnabled=!0,s.enabled=!0,$("#output").fadeOut(300)):($("#output").fadeIn(300),t.updateURL(),s.enabled=!1))},i=function(e){};document.addEventListener("pointerlockchange",e,!1),document.addEventListener("mozpointerlockchange",e,!1),document.addEventListener("webkitpointerlockchange",e,!1),document.addEventListener("pointerlockerror",i,!1),document.addEventListener("mozpointerlockerror",i,!1),document.addEventListener("webkitpointerlockerror",i,!1),r.getRenderer().domElement.addEventListener("mousedown",function(e){g&&t.lock()},!1),$("#outputWrapper").on("mousedown",function(e){g&&t.lock()}),document.addEventListener("mouseup",function(e){document.exitPointerLock(),s.enabled=!1},!1),s=new THREE.PointerLockControls(r.getCamera(),.002),r.getScene().add(s.getObject());return document.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:d=!0;break;case 37:case 65:u=!0;break;case 40:case 83:p=!0;break;case 39:case 68:h=!0;break;case 32:(c=!0)===o&&(l.y+=m,o=!1)}},!1),document.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:d=!1;break;case 37:case 65:u=!1;break;case 40:case 83:p=!1;break;case 39:case 68:h=!1;break;case 32:c=!1,o=!0}},!1),a=new THREE.Raycaster(new THREE.Vector3,new THREE.Vector3(0,-1,0),0,70),!0},t.exports=i},{"./SceneUtils":2}],2:[function(e,t,n){var i,o,a,d,p,s,r=60,l=10,c=5e3,u=null,h=[],m=[],f=[],g=[],v=[],b=0,y=0;function k(e){e instanceof THREE.LOD&&e.update(a)}t.exports={setupScene:function(){i=new THREE.Scene,o=new THREE.Scene;var e=window.innerWidth;p=a=new THREE.PerspectiveCamera(r,e/window.innerHeight,l,b),s=new THREE.PerspectiveCamera(r,e/window.innerHeight,l,1e6);var t,n=new THREE.AmbientLight(0);i.add(n),(t=new THREE.DirectionalLight(16777215,.7)).position.set(0,0,1),i.add(t),(t=new THREE.DirectionalLight(16777215,.3)).position.set(-1,1,-1),i.add(t),i.fog=new THREE.Fog(16777215,Math.max(1,b-c),b),(u=new THREE.WebGLRenderer({sortObjects:!1,stencil:!1,premultipliedAlpha:!1,antialiasing:!0})).sortObjects=!1,u.setSize(e,window.innerHeight),u.autoClear=!1,u.domElement.style.position="absolute",document.body.appendChild(u.domElement),$(window).resize(this.resize),this.render()},setPerspective:function(){p=a,this.render()},setOrthographic:function(e,t,n,i,o,a){var s,r=window.innerWidth/window.innerHeight,l=Math.abs(e-t),c=Math.abs(n-i);l/c<r?(e*=s=c*r/(1*l),t*=s):(n*=s=l/r/(1*c),i*=s);e*=1.01,t*=1.01,n*=1.01,i*=1.01,(d=new THREE.OrthographicCamera(e,t,n,i,o,a)).position.set(0*(e+t)/2,-a/2,0*(n+i)/2),d.rotation.set(Math.PI/2,0,0,"YXZ"),p=d,this.render()},setHSLa:function(e,t,n,i){for(var o=0;o<5;o++)g[o]&&(g[o].color.setHSL(e,t,n),g[o].intensity=i,e=(e+.2)%1)},setRenderVisible:function(e){u.domElement.style.display=e?"block":"none"},applyCameraRotationTo:function(e){if(a.parent){var t=a.parent.rotation.x,n=a.parent.parent.rotation.y;e.rotation.set(t,n,0,"YXZ")}},render:function(){null!==u&&(10==++y&&(y=0,i.traverse(k)),u.clear(u.getClearColor()),a==p&&(this.applyCameraRotationTo(s),u.render(o,s)),u.render(i,p))},clear:function(){h.forEach(function(e){i.remove(e)}),m.forEach(function(e){i.remove(e)}),g.forEach(function(e){i.remove(e)}),v.forEach(function(e){o.remove(e)}),m=[],h=[],g=[],v=[],f=[]},resize:function(){var e=window.innerWidth;a.aspect=e/window.innerHeight,s.aspect=e/window.innerHeight,u.setSize(e,window.innerHeight),a.updateProjectionMatrix(),s.updateProjectionMatrix(),t.exports.render()},setAmbientAdd:function(n){g.forEach(function(e){var t=n;e.added&&(t-=e.added),e instanceof THREE.AmbientLight&&e.color.addScalar(t),e.added=n}),t.exports.render()},setFog:function(e){b=e,i&&i.fog&&(i.fog.far=e,i.fog.near=Math.max(1,e-c)),a&&(a.far=e,a.updateProjectionMatrix(),f.forEach(function(e){e.material.uniforms.fogNear.value=i.fog.near,e.material.uniforms.fogFar.value=i.fog.far,e.material.needsUpdate=!0})),this.render()},showProgressPanel:function(e){var t=$("#progressPanel");t.is(":visible")?e&&e():(t.find(".title").html("Loading"),t.find(".progress").html("..."),this.showPanel(t,e))},showMapPanel:function(e){this.showPanel($("#mapPanel"),e)},showPanel:function(e,t){var n=$("#output").find(".ui-panel:visible");this.swapPanels(n,e,!0,t)},swapPanels:function(e,t,n,i){var o="swing";e.parent().css({height:e.parent().height()}),t.removeClass("hidden");var a,s,r=t.height();t.addClass("hidden"),t.css({right:n?-500:"auto",left:n?"auto":-500}),e.css({right:n?-500:"auto"}),n?(a={left:-500},s={right:0}):(a={right:-500},s={left:0}),e.animate(a,0,o,function(){e.addClass("hidden"),e.parent().animate({height:r},0,o,function(){t.removeClass("hidden"),t.animate(s,0,o,i)})})},getScene:function(){return i},getSkyScene:function(){return o},getCamera:function(){return a},getRenderer:function(){return u},getCollisions:function(){return h},getNonCollisions:function(){return m},getTerrainChunks:function(){return f},getSkyObjects:function(){return v},getLights:function(){return g}}},{}],3:[function(e,t,n){var a=e("./UI.js"),s=e("./SceneUtils.js"),r=e("./FlyControls.js"),i=t.exports=function(){this.map,this.stats,this.controller,this.hasPointerLock,this.ui,this.lastTs=-1,this.animating=!1,this.localReader=null,this._mapRect=null,this.animationTime=0,$(document).ready(this.onDocumentReady.bind(this)),this.initAnim=function(){var e=this;$(".content  h1").first().animate({"margin-top":20},e.animationTime),$("nav").slideUp(e.animationTime,function(){$("#intro").delay(e.animationTime).fadeOut(e.animationTime,e.init.bind(e))})},this.init=function(){var n=this;$("#intro").hide(),this.stats=new Stats,$("body").append(this.stats.domElement),this.controller=new r,this.ui=new a($("body"),this.controller,this.loadMap.bind(n)),this.ui.init();var i=$("<input type='file' class='hidden' />"),e=$("<button id='fileInputIcon' tabindex='-1'>Select a Guild Wars 2 .dat file</button>");e.click(function(){i.trigger("click")});i.change(function(e){var t=e.target.files[0];i.val(""),n.localReader=T3D.getLocalReader(t,function(){s.showProgressPanel(function(){$("#output").find(".title").html("Finding maps (first visit only)"),$("#output").find(".progress").html("initializing"),setTimeout(function(){T3D.getMapListAsync(n.localReader,n.applyMapList,!1)},10)})},void 0,void 0,"js/T3D/t3dworker.js")}),$("#filePanel").append(i),$("#filePanel").append(e);var t=$("<span class='link'>Scan all .dat entries for maps</span>");t.click(function(e){confirm("Searching the full .dat file will take roughly 10 minutes depending on file size.\n\nOnce complete the results will be stored locally and available every time you load this .dat.\n\nNote that the vast majority of maps are probably already loaded.Are you sure you want to search the .dat for maps?")&&s.showProgressPanel(function(){$("#output").find(".title").html("Finding maps (first visit only)"),$("#output").find(".progress").html("initializing"),setTimeout(function(){T3D.getMapListAsync(n.localReader,n.applyMapList,!0)},10)})});var o=$("<p class='instruction'>Missing maps? </p>");o.append(t),$("#mapPanel").append(o),document.addEventListener("keydown",this.keyDownListener,!1),document.addEventListener("mousewheel",this.mouseWheelListener,!1),s.setupScene(),s.setRenderVisible(!1),this.hasPointerLock=this.controller.init()},this.loadMap=function(t,e){var n=this;s.showProgressPanel(function(){n.controller.setMapReady(!1),s.setRenderVisible(!1);var e=[{renderClass:T3D.HavokRenderer,settings:{visible:$("#showHavok")[0].checked}},{renderClass:T3D.EnvironmentRenderer,settings:{}},{renderClass:T3D.TerrainRenderer,settings:{anisotropy:s.getRenderer().getMaxAnisotropy()}}];$("#loadZone").prop("checked")&&e.push({renderClass:T3D.ZoneRenderer,settings:{}}),$("#loadProp").prop("checked")&&e.push({renderClass:T3D.PropertiesRenderer,settings:{}}),T3D.renderMapContentsAsync(n.localReader,t,e,n.onMapLoaded.bind(n))})},this.onMapLoaded=function(e){s.clear(),null!=e.ZoneRenderer&&e.ZoneRenderer.meshes.forEach(function(e){s.getScene().add(e),s.getNonCollisions().push(e)}),null!=e.PropertiesRenderer&&e.PropertiesRenderer.meshes.forEach(function(e){s.getScene().add(e),s.getNonCollisions().push(e)}),e.EnvironmentRenderer.skyElements.forEach(function(e){s.getSkyScene().add(e),s.getSkyObjects().push(e)}),e.TerrainRenderer.terrainTiles.forEach(function(e){s.getScene().add(e),s.getTerrainChunks().push(e),s.getCollisions().push(e)}),s.getScene().add(e.TerrainRenderer.water),s.getNonCollisions().push(e.TerrainRenderer.water),null!=e.HavokRenderer&&e.HavokRenderer.meshes.forEach(function(e){s.getScene().add(e),s.getCollisions().push(e)}),e.EnvironmentRenderer.lights.forEach(function(e){s.getScene().add(e),s.getLights().push(e)});var t=e.EnvironmentRenderer.hazeColor,n=new THREE.Color(t[2]/255,t[1]/255,t[0]/255);s.getRenderer().setClearColor(n,1),s.getScene().fog.color.copy(n),_mapRect=e.TerrainRenderer.bounds,this.controller.setMapReady(!0),$("#UI").removeClass("hidden"),$("#ambientSlider").slider("value",e.EnvironmentRenderer.hasLight?0:.5),$("#fogSlider").slider("value",35e3),this.hasPointerLock?s.showPanel($("#suspendedPanel")):s.showPanel($("#errorPanel"));var i=this.controller.getControls();i.getObject().position.set(0,e.TerrainRenderer.bounds?e.TerrainRenderer.bounds.y2:0,0),i.getPitchObject().rotation.x=-Math.PI/2,s.render(),s.setRenderVisible(!0),this.animating||(this.animating=!0,this.animate(0))},this.applyMapList=function(e){var n=$("#mapPicker");n.empty(),n.append($("<option selected='true' disabled='disabled'>Pick Map</option>"));var i=function(e,t){return e.name<t.name?-1:e.name>t.name?1:0};e.maps.sort(i),e.maps.forEach(function(e){var t=$("<optgroup label='"+e.name+"' />");n.append(t),e.maps.sort(i),e.maps.forEach(function(e){t.append("<option value='"+e.fileName+"'>"+e.name+"</option>")})}),s.showMapPanel()},this.mouseWheelListener=function(e){var t=Math.sign(e.wheelDelta),n=$("#moveSpeedSlider"),i=n.slider("option","min"),o=n.slider("option","max"),a=(o-i)*t*.05+n.slider("option","value");a=Math.min(o,a),a=Math.max(i,a),n.slider("option","value",a)},this.animate=function(e){var t=e-this.lastTs;0<t&&(this.lastTs=e,this.controller.update(.001*t)&&s.render(),this.stats.update()),window.requestAnimationFrame(this.animate.bind(this))},this.keyDownListener=function(e){if(85==e.keyCode&&($("#UI").toggle(),s.resize()),73==e.keyCode&&$("#stats").toggle(),80==e.keyCode&&s.setPerspective(),79==e.keyCode){var t=_mapRect;if(t){var n=t.x1,i=t.x2,o=t.y1,a=t.y2;s.setOrthographic(n,i,o,a,1e5,-1e5)}}70==e.keyCode&&$("#flyInput").trigger("click")}};i.prototype.onDocumentReady=function(){console.log("Tyria 3D API version "+T3D.version);var e=T3D.hasWebGL();$("#frontpageLoader").addClass("hidden"),window.WebGLRenderingContext&&e?$("#ILoveYouDiddi").removeClass("hidden").one("click",this.initAnim.bind(this)):$("#errorGL").removeClass("hidden")};new i},{"./FlyControls.js":1,"./SceneUtils.js":2,"./UI.js":4}],4:[function(e,t,n){var d=e("./SceneUtils"),i=function(e,t,n){this.holder=e,this.controller=t,this.loadMap=n};i.prototype.selectMap=function(e){$("#mapPicker option").filter(function(){return $(this).val()==e.fileName}).prop("selected",!0),$("#mapPicker").change()},i.prototype.logProgress=function(){i.op||(i.op=$("#output")),"Find type"!=arguments[0]&&i.op.find(".title").html(arguments[0]),parseFloat(arguments[1])?i.op.find(".progress").html(arguments[1]+"%"):i.op.find(".progress").html(arguments[1])},i.prototype.init=function(){var i=this;T3D.Logger.logFunctions[T3D.Logger.TYPE_PROGRESS]=this.logProgress,T3D.Logger.logFunctions[T3D.Logger.TYPE_DEBUG]=function(){};var e=$("<div id='UI' class='diagonalBG hidden' />");this.holder.append(e);var t=$("<div id='outputWrapper'/>");t.css({top:-500}).delay(0).animate({top:0},0);var n=$("<div id='output' class='diagonalBG'/>");t.append(n),this.holder.append(t),n.append($("<div class='ui-panel' id='filePanel'><p class='title'><span class='titleLink homeLink'>Home</span><span class='titleSeparator'> &#187 </span>File<span class='titleSeparator'> &#187 </span><span class='titleInactive'>Map</span></p><p class='instruction'>Tyria 3D reads data from the Guild Wars 2 <span class='hightlight'>.dat file</span>. This file contains all the assets used to run the game and is located in the Guild Wars 2 install directory, the same directory that the game executable is located in.</p></div>"));var o=$("<div class='ui-panel hidden' id='progressPanel'><p class='title'/><p class='progress'/></div>");n.append(o);var a=$("<div class='ui-panel hidden' id='errorPanel'>Your browser doesn't seem to support Pointer Lock API, navigating the map will not be possible.<br/><br/>Pro tip: <a href='https://www.google.com/chrome/browser/desktop/index.html' target='_blank'>Donwload Google Chrome</a>.</div>");n.append(a);var s=$("<div class='ui-panel hidden' id='suspendedPanel'>This view is suspended until you<br/><br/> <strong>click and hold</strong> to look around<br /><br/>or<br/><br />click the <strong>Lock Mouse</strong> button<br/><br/>When this view is active, use <strong>W A S D</strong> and <strong>space</strong> to move and jump + air jump</div>");n.append(s);var r=$("<div class='ui-panel hidden' id='mapPanel'><p class='title'><span class='titleLink homeLink'>Home</span><span class='titleSeparator'> &#187 </span><span id='mapBack' class='titleLink'>File</span><span class='titleSeparator'> &#187 </span>Map</p><p class='instruction' style='margin-bottom:0;'>Select what data to load and pick a <span class='highlight'>Map</span>.</p></div>");n.append(r),$("#mapBack").click(function(e){d.swapPanels($("#mapPanel"),$("#filePanel"))}),$(".homeLink").click(function(){location.reload()}),r.append($("<label class='noselect'><p class='label'>Zone Models</p><input type='checkbox' id='loadZone' tabindex='-1' /></label><label class='noselect '><p class='label'>Prop Models</p><input type='checkbox' id='loadProp' tabindex='-1' checked='checked' /></label><label class='noselect '><p class='label'>Visible collision</p><input type='checkbox' id='showHavok' tabindex='-1' /></label><br/>"));var l=$("<select id='mapPicker' tabindex='-1'/>");l.append($("<option selected='true' disabled='disabled'>No .dat loaded</option>")),T3D.MapFileList.maps.forEach(function(e){var t=$("<optgroup label='"+e.name+"' />");l.append(t),e.maps.forEach(function(e){t.append("<option value='"+e.fileName+"'>"+e.name+"</option>")})}),l.change(function(e){var t=l.val();i.loadMap(t);var n=$("#mapPicker option").filter(function(){return $(this).val()==t}).html();$("#mapTitle").html(n),l.blur()}),r.append(l),r.append($("<p class='instruction'>Enabling <span class='highlight'>Zone Models</span> allows you to view trees, plants and various 'nature' models. </p><p class='instruction'>Enabling <span class='highlight'>Prop Models</span> allows you to view most of the models in a map. </p><p class='instruction'>Enabling <span class='highlight'>Visible collision</span> allows you to view all the collision data in a map.  The collision data has no textures but will give you a hint of how the map looks with actual models, consider enabling only Visible collision to reduce map loading times.  If you enabled Zone Models or Prop Models you probably don't want Visible collision.</p>"));var c=$("<div class='ui-panel' id='optionsPanel'><p class='title' id='mapTitle'></p><p id='showMapSelection' class='optionsLink' tabindex='-1'>Back to map selection</p><p class='label'>View distance</p><div class='slider' id='fogSlider' tabindex='-1' /><p class='label'>&#128161;</p><div class='slider' id='ambientSlider' tabindex='-1' /><p class='label'>Speed [Scroll Up/Down]</p><div class='slider' id='moveSpeedSlider' tabindex='-1' /><p class='label'>Mouse sensitivity</p><div class='slider' id='mouseSensSlider' tabindex='-1' /><label class='noselect halfLabel'><p class='label'>Fly [F]</p><input id='flyInput' type='checkbox' tabindex='-1' checked='checked'/></label><label class='noselect halfLabel'><p class='label'>Invert mouse</p><input id='invertInput' type='checkbox' tabindex='-1'/></label><p class='uiText'>Toggle UI [U], Toggle Stats [I], Orthographic Cam [O], Perspective Cam [P]</p><button id='mouseLockBtn' tabindex='-1'>Lock Mouse</button><label class='hidden'><p class='label nomargin'>Location URL</p><input class='hidden' id='locationInput' type='text'></input></label></div>");e.append(c),$("#showMapSelection").click(function(){$("#UI").addClass("hidden"),i.controller.setMapReady(!1),d.swapPanels($("#suspendedPanel"),$("#mapPanel")),$("canvas").hide(),$("#mapPicker option").prop("selected",!1),$("#mapPicker option").first().prop("selected",!0)}),$("#moveSpeedSlider").slider({min:4,max:10,step:.01,change:function(e,t){var n=Math.exp(t.value);window.setTimeout(function(){i.controller.setSpeed(n)},10)}}).slider("value",7.5),$("#mouseSensSlider").slider({min:1e-4,max:.01,step:1e-4,change:function(e,t){var n=t.value;window.setTimeout(function(){i.controller.setSensitivity(n)},10)}}).slider("value",.002),$("#fogSlider").slider({min:5e3,max:1e5,step:500,change:function(e,t){d.setFog(t.value)}}),$("#ambientSlider").slider({min:0,max:1,step:.01,change:function(e,t){d.setAmbientAdd(t.value)}}),$("#invertInput").change(function(){i.controller.invertMouse()}),$("#flyInput").change(function(){i.controller.toggleFly()}),$("#mouseLockBtn").click(function(){i.controller.lock()}),$("#locationInput").on("click",function(){this.select()})},t.exports=i},{"./SceneUtils":2}]},{},[3]);
//# sourceMappingURL=T3DAPP-1.0.4.min.js.map
